## Detect abandoned fishing gear and macroplastic with convolutional neural networks

This project aims to train a convolutional neural network that is capable to detect abandoned fishing gear and macroplastic on high-resolution satellite imagery in marine environments.

### Installation requirements

1. Install GDAL
`brew install gdal`

2. Install GDAL Python bindings
`pip install gdal`

3. Install Rasterio
`pip install rasterio`

### 1. Generate training data with the 

Specific training data will be generated by running 

`PYTHONPATH=src python src/training_data/image-crop.py`.

The script takes a geojson file with positions of potential training features and crops images with a size of 42 x 42 px around the provided geo coordinates from the provided satellite images. The outcome may vary depending on the used images.

The following variables can be customised in src/config.ini:

```
[Training data]
cropped_training_data_path=./imagery/training_data/cropped/
geojson_file_path=./data/geo/geojson/*.geojson
satellite_imagery_path=./imagery/training_data/raw/*.tif
```

### 2. Generate training data

1. Retile images that contain training data

`python src/test_data/gdal_retile.py -targetDir imagery/training_data/cropped/[name] imagery/training_data/raw/[imagename].tif -ps 42 42`

2. Find and label negative training data

Optionally training data can cropped using any GIS application (ArcGIS, QGIS)

### 3. Generate test data

Test data has to be cropped into tiles that have the same size as the training data. This can be done with the help of [gdal_retile.py](http://www.gdal.org/gdal_retile.html).

With the following command an image will be split into multiple images with a size of 42px x 42px.

`python src/test_data/gdal_retile.py -targetDir imagery/test_data/cropped/planet/eddies/[name] imagery/test_data/raw/planet/eddies/[name]/[imagename].tif -ps 42 42`

## 2. Train the Convolutional Neuronal Network

### Installation requirements

1. Install pytorch

`pip install torch`

2. Install Torchvision

`pip install torchvision`

3. Install Numpy

`pip install numpy`

### a) Train neural network with the provided training data

`PYTHONPATH=src python src/convnet/image_classifier.py train`

The following variables can be customised in src/config.ini:

```
[CNN Paths]
accuracy_log_path=./data/training/accuracy
model_path=./data/models/gear-cnn
predicted_imagery_path=./data/prediction/imagery
predicted_geodata_path=./data/prediction/geodata

[CNN Training]
image_bands=4
image_mode=RGBA
learning_rate=0.0005
epochs=30

[CNN Resume Training]
checkpoint=20180723_1320
epochs=10

[CNN Prediction]
batch_size=250000
checkpoint=20180723_1320

[CNN Image data]
test_data=./imagery/test_data/cropped/process-data
training_data=./imagery/training_data/classified
validation_data=./imagery/validation_data/classified
```

### b) Resume training of an existing network

`PYTHONPATH=src python src/convnet/image_classifier.py resume`

### c) Use the trained neural network for prediction on the provided test data

`PYTHONPATH=src python src/convnet/image_classifier.py predict`

The following variables can be customised in src/config.ini:

```
# Path to data used for prediction
test_data=./imagery/test_data/cropped/
```
